<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test File Browser</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .breadcrumb { padding: 10px; background: #f0f0f0; margin-bottom: 10px; }
        .breadcrumb a { color: blue; cursor: pointer; text-decoration: underline; }
        .file-list { border: 1px solid #ccc; min-height: 300px; }
        .folder-item, .file-item, .back-button { 
            padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; 
            display: flex; justify-content: space-between; align-items: center;
        }
        .folder-item:hover, .file-item:hover, .back-button:hover { background: #f0f0f0; }
        .item-name { display: flex; align-items: center; gap: 8px; }
        .item-stats { font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <h1>æ–‡ä»¶æµè§ˆå™¨æµ‹è¯•</h1>
    
    <div class="breadcrumb" id="breadcrumb">
        <a onclick="navigateToFolder('')">æ ¹ç›®å½•</a>
    </div>
    
    <div class="file-list" id="fileList">
        <!-- æ–‡ä»¶åˆ—è¡¨ -->
    </div>
    
    <script>
        // æµ‹è¯•æ•°æ®
        const testStats = {
            "file_stats": {
                "README.md": {"lines": 169, "percentage": 4.64},
                "build.gradle.kts": {"lines": 5, "percentage": 0.14},
                "app/MainActivity.kt": {"lines": 554, "percentage": 15.22},
                "app/PlayerActivity.kt": {"lines": 552, "percentage": 15.17},
                "app/src/main/AndroidManifest.xml": {"lines": 73, "percentage": 2.01}
            },
            "folder_stats": {
                ".": {"lines": 567, "files": 7, "percentage": 15.58},
                "app": {"lines": 107, "files": 2, "percentage": 2.94},
                "app/src": {"lines": 200, "files": 3, "percentage": 5.50},
                "app/src/main": {"lines": 73, "files": 1, "percentage": 2.01}
            }
        };
        
        // å…¨å±€å˜é‡
        let currentFolder = '';
        let fileData = {};
        let folderData = {};
        
        // ç»„ç»‡æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æ•°æ®
        function initializeData() {
            console.log('åˆå§‹åŒ–æ•°æ®', testStats);
            
            // å¤„ç†æ–‡ä»¶æ•°æ®
            for (const [filePath, fileInfo] of Object.entries(testStats.file_stats || {})) {
                const pathParts = filePath.split('/');
                const fileName = pathParts[pathParts.length - 1];
                const dirPath = pathParts.length > 1 ? pathParts.slice(0, -1).join('/') : '';
                
                if (!fileData[dirPath]) {
                    fileData[dirPath] = [];
                }
                
                fileData[dirPath].push({
                    name: fileName,
                    path: filePath,
                    lines: fileInfo.lines,
                    percentage: fileInfo.percentage,
                    type: 'file'
                });
            }
            
            // å¤„ç†æ–‡ä»¶å¤¹æ•°æ® - åˆ›å»ºå±‚çº§ç»“æ„
            const allFolders = new Set();
            
            // å…ˆæ”¶é›†æ‰€æœ‰å¯èƒ½çš„æ–‡ä»¶å¤¹è·¯å¾„
            for (const [filePath, fileInfo] of Object.entries(testStats.file_stats || {})) {
                const pathParts = filePath.split('/');
                if (pathParts.length > 1) {
                    // ä¸ºæ–‡ä»¶è·¯å¾„åˆ›å»ºæ‰€æœ‰çˆ¶çº§ç›®å½•
                    for (let i = 1; i < pathParts.length; i++) {
                        const folderPath = pathParts.slice(0, i).join('/');
                        allFolders.add(folderPath);
                    }
                }
            }
            
            // å¤„ç†å·²æœ‰çš„æ–‡ä»¶å¤¹ç»Ÿè®¡æ•°æ®
            for (const [folderPath, folderInfo] of Object.entries(testStats.folder_stats || {})) {
                if (folderPath === '.') {
                    continue;
                }
                allFolders.add(folderPath);
            }
            
            // ä¸ºæ¯ä¸ªæ–‡ä»¶å¤¹åˆ›å»ºæ¡ç›®
            for (const folderPath of allFolders) {
                const pathParts = folderPath.split('/');
                const folderName = pathParts[pathParts.length - 1];
                const parentPath = pathParts.length > 1 ? pathParts.slice(0, -1).join('/') : '';
                
                if (!folderData[parentPath]) {
                    folderData[parentPath] = [];
                }
                
                // ä½¿ç”¨ç»Ÿè®¡æ•°æ®æˆ–é»˜è®¤å€¼
                const folderInfo = testStats.folder_stats[folderPath] || { lines: 0, files: 0, percentage: 0 };
                
                folderData[parentPath].push({
                    name: folderName,
                    path: folderPath,
                    lines: folderInfo.lines || 0,
                    percentage: folderInfo.percentage || 0,
                    files: folderInfo.files || 0,
                    type: 'folder'
                });
            }
            
            // å¯¹æ‰€æœ‰æ•°æ®æŒ‰åç§°æ’åº
            for (const path in folderData) {
                folderData[path].sort((a, b) => a.name.localeCompare(b.name));
            }
            for (const path in fileData) {
                fileData[path].sort((a, b) => a.name.localeCompare(b.name));
            }
            
            console.log('æ–‡ä»¶æ•°æ®:', fileData);
            console.log('æ–‡ä»¶å¤¹æ•°æ®:', folderData);
        }
        
        // å¯¼èˆªåˆ°æŒ‡å®šæ–‡ä»¶å¤¹
        function navigateToFolder(folderPath) {
            currentFolder = folderPath;
            updateBreadcrumb();
            renderFileList();
        }
        
        // æ›´æ–°é¢åŒ…å±‘å¯¼èˆª
        function updateBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            let html = '<a onclick="navigateToFolder(\'\')">æ ¹ç›®å½•</a>';
            
            if (currentFolder) {
                const pathParts = currentFolder.split('/');
                let currentPath = '';
                
                for (let i = 0; i < pathParts.length; i++) {
                    currentPath += (i > 0 ? '/' : '') + pathParts[i];
                    html += ' / ';
                    html += `<a onclick="navigateToFolder('${currentPath}')">${pathParts[i]}</a>`;
                }
            }
            
            breadcrumb.innerHTML = html;
        }
        
        // æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
        function renderFileList() {
            const fileList = document.getElementById('fileList');
            let html = '';
            
            // æ·»åŠ è¿”å›ä¸Šçº§ç›®å½•æŒ‰é’®ï¼ˆå¦‚æœä¸åœ¨æ ¹ç›®å½•ï¼‰
            if (currentFolder) {
                const parentFolder = currentFolder.includes('/') 
                    ? currentFolder.substring(0, currentFolder.lastIndexOf('/'))
                    : '';
                    
                html += `
                    <div class="back-button" onclick="navigateToFolder('${parentFolder}')">
                        <div class="item-name">
                            <span>ğŸ”™</span>
                            <span>è¿”å›ä¸Šçº§ç›®å½•</span>
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹
            const currentFolders = folderData[currentFolder] || [];
            for (const folder of currentFolders) {
                html += `
                    <div class="folder-item" onclick="navigateToFolder('${folder.path}')">
                        <div class="item-name">
                            <span>ğŸ“</span>
                            <span>${folder.name}</span>
                        </div>
                        <div class="item-stats">
                            ${folder.lines} è¡Œ (${folder.percentage.toFixed(1)}%)
                        </div>
                    </div>
                `;
            }
            
            // æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶
            const currentFiles = fileData[currentFolder] || [];
            for (const file of currentFiles) {
                html += `
                    <div class="file-item">
                        <div class="item-name">
                            <span>ğŸ“„</span>
                            <span>${file.name}</span>
                        </div>
                        <div class="item-stats">
                            ${file.lines} è¡Œ (${file.percentage.toFixed(1)}%)
                        </div>
                    </div>
                `;
            }
            
            // å¦‚æœç›®å½•ä¸ºç©º
            if (currentFolders.length === 0 && currentFiles.length === 0) {
                html += `
                    <div class="file-item">
                        <div class="item-name" style="color: #666; font-style: italic;">
                            <span>ğŸ“­</span>
                            <span>æ­¤ç›®å½•ä¸ºç©º</span>
                        </div>
                    </div>
                `;
            }
            
            fileList.innerHTML = html;
        }
        
        // åˆå§‹åŒ–
        function init() {
            console.log('å¼€å§‹åˆå§‹åŒ–...');
            initializeData();
            navigateToFolder('');
            console.log('åˆå§‹åŒ–å®Œæˆ');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>